steps:
  - task: NodeTool@0
    displayName: 'Install Node.js 22.x'
    inputs:
      versionSpec: '22.x'
      checkLatest: true

  - task: Npm@1
    inputs:
      command: 'custom'
      workingDir: 'src/aiglusoft.iam.client'
      customCommand: 'install -g @angular/cli'
      customRegistry: 'useFeed'
      customFeed: '2fee21a6-a3c1-4ec6-bb6f-f615e733108f'

  - task: Npm@1
    inputs:
      command: 'ci'
      workingDir: 'src/aiglusoft.iam.client'
      verbose: true
      customRegistry: 'useFeed'
      customFeed: '2fee21a6-a3c1-4ec6-bb6f-f615e733108f'
    displayName: 'Install Angular Dependencies'

  - script: |
      cd src/aiglusoft.iam.client
      ng test --watch=false --browsers=ChromeHeadless --code-coverage
    displayName: 'Run Angular Unit Tests and Generate Coverage'
    continueOnError: true

  # - task: PublishCodeCoverageResults@1
  #   displayName: 'Publish Angular Code Coverage Results'
  #   inputs:
  #     codeCoverageTool: 'Cobertura'
  #     summaryFileLocation: 'src/aiglusoft.iam.client/coverage/aiglusoft.iam.client/coverage-summary.json'
  #     reportDirectory: 'src/aiglusoft.iam.client/coverage/aiglusoft.iam.client'
  #     failIfCoverageEmpty: true
  #   continueOnError: true

  - script: |
      cd src/aiglusoft.iam.client
      ng build --output-path=src/aiglusoft.iam.client/dist
    displayName: 'Build Angular Project and Copy to dist'